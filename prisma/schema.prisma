generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id             Int             @id @default(autoincrement())
  email          String          @unique
  password       String
  name           String
  role           String          @default("candidate")
  createdAt      DateTime        @default(now())
  resumeUrl      String?
  bio            String?
  city           String?
  headline       String?
  linkedin       String?
  phone          String?
  resumePublicId String?
  applications   Application[]
  companyProfile CompanyProfile?
  jobs           Job[]
  tags           Tag[]           @relation("UserToTag")
}

model Job {
  id           Int           @id @default(autoincrement())
  title        String
  description  String
  salary       String?
  createdAt    DateTime      @default(now())
  authorId     Int
  category     String        @default("Otros")
  location     String?
  modality     String        @default("Remoto")
  status       String        @default("PUBLISHED")
  expiresAt    DateTime?
  applications Application[]
  author       User          @relation(fields: [authorId], references: [id], onDelete: Cascade)
  tags         Tag[]         @relation("JobToTag")
}

model Tag {
  id    Int    @id @default(autoincrement())
  name  String @unique
  type  String
  jobs  Job[]  @relation("JobToTag")
  users User[] @relation("UserToTag")
}

model Application {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  status    String   @default("PENDING")
  userId    Int
  jobId     Int
  job       Job      @relation(fields: [jobId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, jobId])
}

model CompanyProfile {
  id          Int     @id @default(autoincrement())
  logo        String?
  website     String?
  description String?
  userId      Int     @unique
  legalName   String
  cuit        String
  industry    String
  user        User    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model SystemSetting {
  key         String  @id
  value       String
  description String?
}

model SystemLog {
  id        String   @id @default(cuid())
  level     String
  message   String
  metadata  Json?
  source    String
  createdAt DateTime @default(now())

  @@index([level])
  @@index([createdAt])
}
